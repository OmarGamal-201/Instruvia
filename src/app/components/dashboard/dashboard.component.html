<div class="min-vh-100 bg-light" [attr.dir]="isRTL ? 'rtl' : 'ltr'">
  <!-- Language Toggle Button -->
  <div class="container pt-3">
    <div class="d-flex justify-content-end">
      <button class="btn btn-outline-primary btn-sm" (click)="toggleLanguage()">
        <i class="bi bi-translate me-2"></i>
        {{ currentLanguage === 'en' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English' }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="container py-5 text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ translate('loading') }}</span>
    </div>
    <p class="mt-3 text-secondary">{{ translate('loading') }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="container py-5">
    <div class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>
      {{ error }}
      <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadDashboardData()">
        {{ translate('retry') }}
      </button>
    </div>
  </div>

  <!-- Main Dashboard Content -->
  <main class="container py-4" *ngIf="!loading && !error">
    <!-- Welcome Section -->
    <div class="mb-4">
      <h2 class="fw-bold fs-2 mb-1">{{ translate('welcome.back') }}, {{ userName }}! ðŸ‘‹</h2>
      <p class="text-secondary">{{ translate('continue.journey') }}</p>
    </div>

    <!-- Stats Grid -->
    <div class="row g-4 mb-4">
      <div class="col-12 col-md-6 col-lg-3 stat" *ngFor="let stat of statsDisplay">
        <div class="card border shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <!-- Dynamic Icon -->
              <div class="rounded text-white" [style.background]="stat.color">
                <svg width="56" height="56" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="4" y="4" width="56" height="56" rx="12" [attr.fill]="stat.color" />
                  <ng-container [ngSwitch]="stat.icon">
                    <!-- Book Icon -->
                    <path *ngSwitchCase="'book'"
                      d="M20 18H44C45.1046 18 46 18.8954 46 20V44C46 45.1046 45.1046 46 44 46H20C18.8954 46 18 45.1046 18 44V20C18 18.8954 18.8954 18 20 18ZM32 20V46"
                      stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                    <!-- Calendar Icon -->
                    <path *ngSwitchCase="'calendar'"
                      d="M22 20H42C43.1046 20 44 20.8954 44 22V42C44 43.1046 43.1046 44 42 44H22C20.8954 44 20 43.1046 20 42V22C20 20.8954 20.8954 20 22 20ZM28 18V22M36 18V22M20 28H44"
                      stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                    <!-- Award Icon -->
                    <path *ngSwitchCase="'award'"
                      d="M32 38C36.4183 38 40 34.4183 40 30C40 25.5817 36.4183 22 32 22C27.5817 22 24 25.5817 24 30C24 34.4183 27.5817 38 32 38ZM28 38L26 46L32 42L38 46L36 38"
                      stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                    <!-- Fire Icon -->
                    <path *ngSwitchCase="'fire'"
                      d="M32 16C28 20 24 26 24 32C24 36.4183 27.5817 40 32 40C36.4183 40 40 36.4183 40 32C40 26 36 20 32 16ZM32 28C30 30 28 32 28 34C28 35.1046 28.8954 36 30 36C31.1046 36 32 35.1046 32 34C32 32 34 30 36 28"
                      stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
                  </ng-container>
                </svg>
              </div>
            </div>
            <h3 class="fw-bold fs-2">{{ getStatValue(stat.key) }}</h3>
            <p class="text-secondary m-0">{{ translate(stat.label) }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- LEFT COLUMN -->
      <div class="col-lg-8">
        <!-- Continue Learning -->
        <div class="card border shadow-sm mb-4">
          <div class="card-body">
            <div class="d-flex justify-content-between mb-4">
              <h3 class="fw-bold fs-4">{{ translate('continue.learning') }}</h3>
              <button class="btn fw-semibold head-btn" (click)="viewAllCourses()">
                {{ translate('view.all') }}
              </button>
            </div>

            <!-- Empty State -->
            <div *ngIf="continueLearning.length === 0" class="text-center py-5">
              <i class="bi bi-book text-secondary" style="font-size: 3rem;"></i>
              <p class="text-secondary mt-3">{{ translate('no.courses') }}</p>
              <button class="btn btn-primary" (click)="viewAllCourses()">
                {{ translate('browse.courses') }}
              </button>
            </div>

            <!-- Courses List -->
            <div class="d-flex flex-column gap-3" *ngIf="continueLearning.length > 0">
              <div *ngFor="let course of getContinueLearning()"
                class="border rounded p-3 hover-shadow-sm fade-in continue-card">
                <div class="d-flex gap-3">
                  <!-- Thumbnail -->
                  <img *ngIf="course.thumbnail"
                    [src]="course.thumbnail"
                    [alt]="course.title"
                    class="rounded"
                    style="width: 80px; height: 80px; object-fit: cover;">
                  <div class="flex-grow-1">
                    <h4 class="fw-semibold mb-1">{{ course.title }}</h4>
                    <p class="text-secondary small mb-2">{{ course.instructor }}</p>
                    <span class="badge bg-primary bg-opacity-10 text-primary">
                      {{ course.category }}
                    </span>
                  </div>
                </div>

                <div class="mt-3">
                  <small class="d-flex justify-content-between mb-1">
                    <span class="text-secondary">{{ translate('progress') }}</span>
                    <span class="fw-semibold">{{ course.progress }}%</span>
                  </small>

                  <div class="progress mb-3" style="height: 0.55rem">
                    <div class="progress-bar"
                      [style.width.%]="course.progress"
                      [class.bg-success]="course.progress === 100"
                      role="progressbar"></div>
                  </div>

                  <div class="d-flex justify-content-between align-items-center">
                    <small class="text-secondary">
                      {{ course.completedLessons }} {{ translate('of') }} {{ course.totalLessons }} {{ translate('lessons') }}
                    </small>
                    <button class="btn btn-primary btn-sm" (click)="continueCourse(course._id)">
                      {{ translate('continue') }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Upcoming Consultations -->
        <div class="card border shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between mb-4">
              <h3 class="fw-bold fs-4">{{ translate('upcoming.consultations') }}</h3>
              <button class="btn head-btn fw-semibold" (click)="bookMoreSessions()">
                {{ translate('book.more') }}
              </button>
            </div>

            <!-- Empty State -->
            <div *ngIf="consultations.length === 0" class="text-center py-5">
              <i class="bi bi-calendar-event text-secondary" style="font-size: 3rem;"></i>
              <p class="text-secondary mt-3">{{ translate('no.consultations') }}</p>
              <button class="btn btn-primary" (click)="bookMoreSessions()">
                {{ translate('book.session') }}
              </button>
            </div>

            <!-- Consultations List -->
            <div class="d-flex flex-column gap-3" *ngIf="consultations.length > 0">
              <div *ngFor="let consultation of consultations"
                class="border rounded p-3 fade-in hover-shadow-sm">
                <div class="d-flex align-items-center gap-3 mb-2 consultation-card">
                  <div class="avatar-gradient">
                    {{ getInitials(consultation.instructor) }}
                  </div>
                  <div>
                    <h4 class="fw-semibold small">{{ consultation.instructor }}</h4>
                    <span class="badge bg-primary bg-opacity-10 text-primary">
                      {{ consultation.day }}
                    </span>
                  </div>
                </div>
                <p class="fw-semibold small mb-2">{{ consultation.session }}</p>
                <div class="d-flex gap-3 small text-secondary mb-3">
                  <span><i class="bi bi-clock me-1"></i> {{ consultation.time }}</span>
                  <span><i class="bi bi-play-btn me-1"></i> {{ consultation.duration }}</span>
                </div>
                <button class="btn btn-primary w-100" (click)="joinSession(consultation._id)">
                  {{ translate('join.session') }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="col-lg-4">
        <!-- Recent Activity -->
        <div class="card border shadow-sm mb-4">
          <div class="card-body">
            <h3 class="fw-bold fs-4 mb-4">{{ translate('recent.activity') }}</h3>

            <!-- Empty State -->
            <div *ngIf="recentActivity.length === 0" class="text-center py-4">
              <i class="bi bi-activity text-secondary" style="font-size: 2rem;"></i>
              <p class="text-secondary small mt-2">{{ translate('no.activity') }}</p>
            </div>

            <!-- Activity List -->
            <div class="d-flex flex-column gap-3" *ngIf="recentActivity.length > 0">
              <div *ngFor="let activity of recentActivity; let last = last"
                class="d-flex align-items-start gap-3 pb-3 fade-in"
                [class.border-bottom]="!last">
                <div class="activity-icon bg-primary bg-opacity-10 text-primary rounded p-2">
                  <i class="bi bi-book fs-6"></i>
                </div>
                <div class="flex-grow-1">
                  <h4 class="fw-semibold small mb-1">{{ activity.title }}</h4>
                  <p class="text-secondary small m-0">{{ activity.subtitle }}</p>
                  <p class="text-muted small m-0">{{ activity.instructor }}</p>
                </div>
                <span class="text-muted small">{{ activity.time }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recommended Courses -->
        <div class="card border shadow-sm">
          <div class="card-body">
            <h3 class="fw-bold fs-4 mb-4">{{ translate('recommended') }}</h3>

            <!-- Empty State -->
            <div *ngIf="recommended.length === 0" class="text-center py-4">
              <i class="bi bi-lightbulb text-secondary" style="font-size: 2rem;"></i>
              <p class="text-secondary small mt-2">{{ translate('no.recommendations') }}</p>
            </div>

            <!-- Recommendations List -->
            <div class="d-flex flex-column gap-4" *ngIf="recommended.length > 0">
              <div class="d-flex gap-3 fade-in" *ngFor="let course of recommended">
                <div class="recommend-icon bg-primary rounded d-flex align-items-center justify-content-center"
                  style="min-width: 56px; height: 56px;">
                  <i class="bi bi-book text-white fs-4"></i>
                </div>
                <div class="flex-grow-1">
                  <h4 class="fw-semibold small mb-1">{{ course.title }}</h4>
                  <p class="text-secondary small m-0">{{ course.instructor }}</p>
                  <div class="d-flex align-items-center mt-1">
                    <i class="bi bi-star-fill text-warning me-1 small"></i>
                    <span class="fw-semibold small">{{ course.rating }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
